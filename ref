#!/usr/bin/python3
import shelve
import os
import sys
import random
from pathlib import Path
from helper_functions import create_command_list, filter_dirs_with_period, copy_file


def main():
    shelf = shelve.open("save_file")
    if len(sys.argv) == 1:
        print(create_command_list())
        shelf.close()
        return
    home_dir = Path.home()
    command = sys.argv[1]
    if command == "reset" or command == "add":
        home_dir_list = filter_dirs_with_period(os.listdir(home_dir), home_dir)
        list_of_directories_in_home = "list of Directories:\n\n"
        ref_photo_dir = None

        for i in range(len(home_dir_list)):
            list_of_directories_in_home += f"- {home_dir_list[i]}\n"
        ref_photo_dir = input(
            (
                f"{list_of_directories_in_home}Please type in the directory "
                "name that contains the reference\n"
                "image files or create a new one: \n"
            )
        )
        shelf["ref_photo_dir"] = ref_photo_dir
        if not (ref_photo_dir) in home_dir_list:
            os.makedirs(f"{home_dir}/{ref_photo_dir}")
    if command == "current":
        print(f"Current Directory:  {shelf['ref_photo_dir']}")
    if command == "shuffle":
        image_list = []
        parent_dir = home_dir / shelf["ref_photo_dir"]
        current_glob_list = filter_dirs_with_period(list(parent_dir.glob("*")))
        # check if the directory that holds the randomly picked images exits
        if not (parent_dir / "Ref_Inbox") in current_glob_list:
            # create it if it does not
            os.makedirs(f"{parent_dir}/Ref_Inbox")
        else:
            # delete previous directory
            previous_ref_dir = parent_dir / "Ref_Inbox"
            previous_glob = list(previous_ref_dir.glob("*.jpg"))
            for image in previous_glob:
                os.unlink(image)
        for item in current_glob_list:
            if item.name == "Ultimate Female Poses Sample Pack":
                glob_list = filter_dirs_with_period(list(item.glob("*.jpg")))
                for image in glob_list:
                    image_list.append(image)
                for i in range(int(sys.argv[2]) + 1):
                    random_index = random.randrange(0, len(image_list))
                    copy_file(image_list[random_index], parent_dir / "Ref_Inbox")

    shelf.close()


if __name__ == "__main__":
    main()
